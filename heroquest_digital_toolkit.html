<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeroQuest Digital Toolkit - Dice Roller & Essential Game Tools</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="icon" href="/favicon.png" type="image/png">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>

<style>
    /* Base styling with digital theme and excellent readability */
    body {
        font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        line-height: 1.7;
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 50%, #f8fafc 100%);
        color: #1e293b;
        font-size: 16px;
    }

    /* Main container with tech styling */
    .container.toolkit-realm {
        background: white;
        padding: 48px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
    }

    /* Main heading with tech theme */
    h1 {
        color: #3730a3;
        text-align: center;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 32px;
        border-bottom: 3px solid #6366f1;
        padding-bottom: 16px;
        line-height: 1.2;
    }

    /* Section headings */
    h2 {
        color: #4338ca;
        border-bottom: 2px solid #6366f1;
        padding-bottom: 12px;
        margin: 48px 0 24px 0;
        font-size: 1.75rem;
        font-weight: 600;
    }

    h3.tool-title {
        color: #5b21b6;
        font-size: 1.4rem;
        font-weight: 600;
        margin: 16px 0;
        text-align: center;
    }

    /* Hero banner */
    .hero-banner {
        text-align: center;
        font-size: 1.1rem;
        color: #475569;
        margin-bottom: 32px;
        padding: 32px;
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        border-radius: 12px;
        border: 2px solid #c7d2fe;
        border-left: 6px solid #6366f1;
    }

    .hero-banner strong {
        color: #1e293b;
        font-weight: 600;
        display: block;
        margin-bottom: 8px;
        font-size: 1.2rem;
    }

    .hero-banner em {
        color: #64748b;
        font-style: italic;
        display: block;
        margin-top: 12px;
        font-size: 0.95rem;
    }

    /* Quick actions bar */
    .quick-actions {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin: 32px 0;
        flex-wrap: wrap;
    }

    .quick-btn {
        background: linear-gradient(135deg, #6366f1, #4f46e5);
        border: 2px solid #a5b4fc;
        border-radius: 8px;
        color: white;
        padding: 12px 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        text-transform: uppercase;
        font-size: 12px;
        text-decoration: none;
        display: inline-block;
    }

    .quick-btn:hover {
        background: linear-gradient(135deg, #4f46e5, #4338ca);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
    }

    /* Toolkit grid layout */
    .toolkit-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 24px;
        margin: 32px 0;
    }

    /* Tool panels */
    .tool-panel {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
        border-left: 4px solid #6366f1;
    }

    .tool-panel:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    /* Character sheet styling */
    .character-sheet {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
    }

    .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e2e8f0;
    }

    .stat-row:last-child {
        border-bottom: none;
    }

    .stat-label {
        color: #475569;
        font-weight: 500;
    }

    .stat-value {
        color: #1e293b;
        font-weight: 600;
        background: #6366f1;
        color: white;
        padding: 4px 12px;
        border-radius: 6px;
        min-width: 40px;
        text-align: center;
    }

    /* Dice rolling interface */
    .dice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
        margin: 20px 0;
    }

    .dice-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        border: 2px solid #34d399;
        border-radius: 8px;
        color: white;
        padding: 16px 12px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        text-align: center;
        font-size: 14px;
    }

    .dice-btn:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Roll results display */
    .roll-result {
        background: #f1f5f9;
        border: 2px solid #cbd5e0;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
        text-align: center;
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Spell calculator */
    .spell-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
        margin: 20px 0;
    }

    .spell-card {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        border: 2px solid #c4b5fd;
        border-radius: 10px;
        padding: 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        color: white;
    }

    .spell-card:hover {
        background: linear-gradient(135deg, #7c3aed, #6d28d9);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .spell-card.selected {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        border-color: #fbbf24;
        color: #1e293b;
    }

    .spell-name {
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .spell-cost {
        font-size: 12px;
        opacity: 0.9;
    }

    /* Mana tracker */
    .mana-tracker {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin: 20px 0;
        flex-wrap: wrap;
    }

    .mana-circle {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #8b5cf6;
        border: 2px solid #c4b5fd;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 12px;
    }

    .mana-circle.spent {
        background: #9ca3af;
        border-color: #d1d5db;
        color: #6b7280;
    }

    .mana-circle:hover {
        transform: scale(1.2);
        box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
    }

    /* Combat calculator */
    .combat-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }

    .combatant {
        background: #f8fafc;
        border: 2px solid #c7d2fe;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
    }

    .combatant.hero {
        border-color: #34d399;
        border-left: 4px solid #10b981;
    }

    .combatant.monster {
        border-color: #f87171;
        border-left: 4px solid #ef4444;
    }

    /* Button styles */
    .roll-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        border: 2px solid #34d399;
        border-radius: 8px;
        color: white;
        padding: 12px 24px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-block;
        margin: 4px;
    }

    .roll-btn:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .treasure-btn {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        border: 2px solid #fbbf24;
        border-radius: 8px;
        color: white;
        padding: 12px 24px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-block;
        margin: 4px;
    }

    .treasure-btn:hover {
        background: linear-gradient(135deg, #d97706, #b45309);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    /* Settings toggles */
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
    }

    .setting-label {
        color: #475569;
        font-weight: 500;
    }

    .setting-toggle {
        width: 48px;
        height: 24px;
        background: #9ca3af;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }

    .setting-toggle.active {
        background: #10b981;
    }

    .setting-toggle::before {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: all 0.2s ease;
    }

    .setting-toggle.active::before {
        transform: translateX(24px);
    }

    /* Text improvements */
    p {
        margin-bottom: 16px;
        line-height: 1.7;
        color: #334155;
    }

    strong {
        color: #1e293b;
        font-weight: 600;
    }

    em {
        color: #64748b;
        font-style: italic;
    }

    /* Links */
    a {
        color: #6366f1;
        text-decoration: none;
        font-weight: 500;
        border-bottom: 1px solid transparent;
        transition: all 0.2s ease;
    }

    a:hover {
        color: #4f46e5;
        border-bottom-color: #4f46e5;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        body {
            padding: 16px;
        }
        
        .container.toolkit-realm {
            padding: 24px;
        }
        
        h1 {
            font-size: 2rem;
        }
        
        .toolkit-grid {
            grid-template-columns: 1fr;
        }
        
        .quick-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .combat-grid {
            grid-template-columns: 1fr;
        }
        
        .dice-grid {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }
        
        .spell-grid {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
    }

    /* Focus accessibility */
    :focus {
        outline: 2px solid #6366f1;
        outline-offset: 2px;
    }

    /* Reduced motion accessibility */
    @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
</head>
<body>
    <div class="container toolkit-realm">
        <h1>üé≤ HeroQuest Digital Toolkit üõ†Ô∏è</h1>
        
        <div class="hero-banner" style="text-align: center; font-size: 1.1em; color: #c5cae9; margin-bottom: 30px; padding: 20px; background: rgba(83, 52, 131, 0.3); border-radius: 15px; border: 2px solid #7209b7;">
            <strong>Your Complete Digital Companion for Epic Adventures!</strong><br>
            Advanced dice rolling, character tracking, combat calculator, and quest management tools.<br>
            <em>Everything you need to enhance your HeroQuest experience in one powerful toolkit.</em>
        </div>

        <div class="quick-actions">
            <button class="quick-btn" onclick="quickRoll('combat')">‚öîÔ∏è Combat Roll</button>
            <button class="quick-btn" onclick="quickRoll('defense')">üõ°Ô∏è Defense Roll</button>
            <button class="quick-btn" onclick="quickRoll('movement')">ü¶∂ Movement Roll</button>
            <button class="quick-btn" onclick="quickRoll('magic')">üîÆ Magic Roll</button>
            <button class="quick-btn" onclick="restoreAll()">üíö Full Heal</button>
            <button class="quick-btn" onclick="generateTreasure()">üí∞ Treasure!</button>
        </div>

        <h2>üé≤ Advanced Dice Roller</h2>
        
        <div class="mermaid">
            graph TD
                A[Digital Toolkit] --> B[Dice Roller]
                A --> C[Character Tracker]
                A --> D[Combat Calculator]
                A --> E[Quest Manager]
                
                B --> B1[Combat Dice]
                B --> B2[Defense Dice]
                B --> B3[Movement Dice]
                B --> B4[Custom Rolls]
                
                C --> C1[Health Tracking]
                C --> C2[Stats Management]
                C --> C3[Equipment Lists]
                C --> C4[Spell Tracking]
                
                D --> D1[Damage Calculator]
                D --> D2[Hit Probability]
                D --> D3[Armor Effects]
                D --> D4[Critical Hits]
                
                E --> E1[Quest Progress]
                E --> E2[Objective Tracking]
                E --> E3[Treasure Generator]
                E --> E4[Notes System]
                
                style A fill:#a663cc,stroke:#333,stroke-width:3px
                style B fill:#7209b7,stroke:#333,stroke-width:2px
                style C fill:#533483,stroke:#333,stroke-width:2px
                style D fill:#9c88ff,stroke:#333,stroke-width:2px
                style E fill:#c5cae9,stroke:#333,stroke-width:2px
        </div>

        <div class="toolkit-grid">
            <div class="tool-panel">
                <h3 class="tool-title">üé≤ Dice Roller</h3>
                
                <div class="dice-container">
                    <div class="die combat-die" id="combat_die_1" onclick="rollSingleDie(this, 'combat')">‚öîÔ∏è</div>
                    <div class="die combat-die" id="combat_die_2" onclick="rollSingleDie(this, 'combat')">‚öîÔ∏è</div>
                    <div class="die defense-die" id="defense_die_1" onclick="rollSingleDie(this, 'defense')">üõ°Ô∏è</div>
                    <div class="die defense-die" id="defense_die_2" onclick="rollSingleDie(this, 'defense')">üõ°Ô∏è</div>
                    <div class="die movement-die" id="movement_die" onclick="rollSingleDie(this, 'movement')">ü¶∂</div>
                    <div class="die magic-die" id="magic_die" onclick="rollSingleDie(this, 'magic')">üîÆ</div>
                </div>
                
                <div class="roll-controls">
                    <button class="roll-btn" onclick="rollDice('combat', 2)">Combat Roll</button>
                    <button class="roll-btn" onclick="rollDice('defense', 2)">Defense Roll</button>
                    <button class="roll-btn" onclick="rollDice('movement', 2)">Move Roll</button>
                    <button class="roll-btn" onclick="rollDice('magic', 1)">Magic Roll</button>
                </div>
                
                <div class="roll-results" id="dice_results">
                    <div class="result-total">Ready to Roll!</div>
                    <div class="result-breakdown">Select dice type or click individual dice to roll</div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">üë§ Character Sheet</h3>
                
                <div class="character-sheet">
                    <div class="stat-row">
                        <div class="stat-label">‚öîÔ∏è Attack Power</div>
                        <div class="stat-modifier">
                            <button class="mod-btn" onclick="modifyStat('attack', -1)">-</button>
                            <button class="mod-btn" onclick="modifyStat('attack', 1)">+</button>
                        </div>
                        <div class="stat-value" id="attack_stat">2</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">üõ°Ô∏è Defense Power</div>
                        <div class="stat-modifier">
                            <button class="mod-btn" onclick="modifyStat('defense', -1)">-</button>
                            <button class="mod-btn" onclick="modifyStat('defense', 1)">+</button>
                        </div>
                        <div class="stat-value" id="defense_stat">2</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">ü¶∂ Movement Speed</div>
                        <div class="stat-modifier">
                            <button class="mod-btn" onclick="modifyStat('movement', -1)">-</button>
                            <button class="mod-btn" onclick="modifyStat('movement', 1)">+</button>
                        </div>
                        <div class="stat-value" id="movement_stat">2</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">üîÆ Magic Power</div>
                        <div class="stat-modifier">
                            <button class="mod-btn" onclick="modifyStat('magic', -1)">-</button>
                            <button class="mod-btn" onclick="modifyStat('magic', 1)">+</button>
                        </div>
                        <div class="stat-value" id="magic_stat">2</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">üí∞ Gold Coins</div>
                        <div class="stat-modifier">
                            <button class="mod-btn" onclick="modifyStat('gold', -10)">-</button>
                            <button class="mod-btn" onclick="modifyStat('gold', 10)">+</button>
                        </div>
                        <div class="stat-value" id="gold_stat">50</div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">‚ù§Ô∏è Health Tracker</h3>
                
                <div class="health-tracker">
                    <div class="health-bar">
                        <div class="health-character">üßô Wizard</div>
                        <div class="health-display">
                            <div class="health-hearts" id="wizard_health">
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                            </div>
                            <button class="mod-btn" onclick="restoreHealth('wizard_health')">üíö</button>
                        </div>
                    </div>
                    
                    <div class="health-bar">
                        <div class="health-character">‚öîÔ∏è Barbarian</div>
                        <div class="health-display">
                            <div class="health-hearts" id="barbarian_health">
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                            </div>
                            <button class="mod-btn" onclick="restoreHealth('barbarian_health')">üíö</button>
                        </div>
                    </div>
                    
                    <div class="health-bar">
                        <div class="health-character">üèπ Elf</div>
                        <div class="health-display">
                            <div class="health-hearts" id="elf_health">
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                            </div>
                            <button class="mod-btn" onclick="restoreHealth('elf_health')">üíö</button>
                        </div>
                    </div>
                    
                    <div class="health-bar">
                        <div class="health-character">üõ°Ô∏è Dwarf</div>
                        <div class="health-display">
                            <div class="health-hearts" id="dwarf_health">
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                            </div>
                            <button class="mod-btn" onclick="restoreHealth('dwarf_health')">üíö</button>
                        </div>
                    </div>
                    
                    <div class="health-bar">
                        <div class="health-character">üî• Expansion Hero</div>
                        <div class="health-display">
                            <div class="health-hearts" id="expansion_health">
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                                <div class="heart" onclick="toggleHeart(this)"></div>
                            </div>
                            <button class="mod-btn" onclick="restoreHealth('expansion_health')">üíö</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">üìú Quest Tracker</h3>
                
                <div class="quest-tracker">
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Find the entrance to the underground labyrinth</div>
                    </div>
                    
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Defeat the Orc guards in the first chamber</div>
                    </div>
                    
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Locate the Wizard's lost spellbook</div>
                    </div>
                    
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Discover the secret door behind the throne</div>
                    </div>
                    
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Confront the evil Warlock in his lair</div>
                    </div>
                    
                    <div class="quest-item" onclick="toggleQuest(this)">
                        <div class="quest-checkbox"></div>
                        <div class="quest-text">Escape with the ancient artifact intact</div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">üí∞ Treasure Generator</h3>
                
                <div class="treasure-generator">
                    <div class="treasure-display" id="treasure_display">
                        Click below to generate random treasure!<br>
                        üíé Discover what awaits in the depths! üíé
                    </div>
                    
                    <button class="treasure-btn" onclick="generateTreasure()">
                        üé≤ Generate Treasure
                    </button>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">üîÆ Spell Calculator</h3>
                
                <div class="spell-calculator">
                    <div class="mana-tracker" id="mana_tracker">
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <div class="mana-circle" onclick="toggleMana(this)"></div>
                        <button class="mod-btn" onclick="restoreMana()" style="margin-left: 10px;">üîÆ</button>
                    </div>
                    
                    <div class="spell-grid">
                        <div class="spell-card" onclick="castSpell(this, 1)" data-cost="1">
                            <div class="spell-name">Heal Body</div>
                            <div class="spell-cost">1 Mana</div>
                        </div>
                        
                        <div class="spell-card" onclick="castSpell(this, 2)" data-cost="2">
                            <div class="spell-name">Fire Ball</div>
                            <div class="spell-cost">2 Mana</div>
                        </div>
                        
                        <div class="spell-card" onclick="castSpell(this, 1)" data-cost="1">
                            <div class="spell-name">Pass Through Rock</div>
                            <div class="spell-cost">1 Mana</div>
                        </div>
                        
                        <div class="spell-card" onclick="castSpell(this, 3)" data-cost="3">
                            <div class="spell-name">Tempest</div>
                            <div class="spell-cost">3 Mana</div>
                        </div>
                        
                        <div class="spell-card" onclick="castSpell(this, 2)" data-cost="2">
                            <div class="spell-name">Lightning Bolt</div>
                            <div class="spell-cost">2 Mana</div>
                        </div>
                        
                        <div class="spell-card" onclick="castSpell(this, 1)" data-cost="1">
                            <div class="spell-name">Courage</div>
                            <div class="spell-cost">1 Mana</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">‚öîÔ∏è Combat Calculator</h3>
                
                <div class="combat-calculator">
                    <div class="combat-grid">
                        <div class="combatant hero">
                            <div class="combatant-name">ü¶∏ Hero</div>
                            <div class="combat-stats">
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Attack</div>
                                    <div class="combat-stat-value" id="hero_attack">2</div>
                                </div>
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Defense</div>
                                    <div class="combat-stat-value" id="hero_defense">2</div>
                                </div>
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Health</div>
                                    <div class="combat-stat-value" id="hero_health">4</div>
                                </div>
                            </div>
                            <button class="roll-btn" onclick="calculateCombat('hero')">Roll Attack</button>
                        </div>
                        
                        <div class="combatant monster">
                            <div class="combatant-name">üëπ Monster</div>
                            <div class="combat-stats">
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Attack</div>
                                    <div class="combat-stat-value" id="monster_attack">2</div>
                                </div>
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Defense</div>
                                    <div class="combat-stat-value" id="monster_defense">1</div>
                                </div>
                                <div class="combat-stat">
                                    <div class="combat-stat-label">Health</div>
                                    <div class="combat-stat-value" id="monster_health">3</div>
                                </div>
                            </div>
                            <button class="roll-btn" onclick="calculateCombat('monster')">Roll Attack</button>
                        </div>
                    </div>
                    
                    <div class="roll-results" id="combat_results">
                        <div class="result-total">Combat Ready!</div>
                        <div class="result-breakdown">Click Roll Attack to begin combat</div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">‚öôÔ∏è Toolkit Settings</h3>
                
                <div class="settings-panel">
                    <div class="setting-row">
                        <div class="setting-label">üîä Sound Effects</div>
                        <div class="setting-toggle active" id="sound_toggle" onclick="toggleSetting(this, 'sound')"></div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">üì≥ Vibration Feedback</div>
                        <div class="setting-toggle" id="vibration_toggle" onclick="toggleSetting(this, 'vibration')"></div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">üé≠ Advanced Mode</div>
                        <div class="setting-toggle" id="advanced_toggle" onclick="toggleSetting(this, 'advanced')"></div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">üíæ Auto-Save Progress</div>
                        <div class="setting-toggle active" id="autosave_toggle" onclick="toggleSetting(this, 'autosave')"></div>
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">üé® Dark Theme</div>
                        <div class="setting-toggle active" id="theme_toggle" onclick="toggleSetting(this, 'theme')"></div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="treasure-btn" onclick="saveProgress()" style="margin-right: 10px;">üíæ Save Game</button>
                    <button class="roll-btn" onclick="loadProgress()">üìÅ Load Game</button>
                </div>
            </div>
        </div>

        <h2>üìä Game Statistics & Analytics</h2>
        
        <div class="toolkit-grid">
            <div class="tool-panel">
                <h3 class="tool-title">üìà Session Statistics</h3>
                
                <div class="character-sheet">
                    <div class="stat-row">
                        <div class="stat-label">üé≤ Total Rolls</div>
                        <div class="stat-value" id="total_rolls">0</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">‚öîÔ∏è Combat Encounters</div>
                        <div class="stat-value" id="combat_encounters">0</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">üîÆ Spells Cast</div>
                        <div class="stat-value" id="spells_cast">0</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">üí∞ Treasure Found</div>
                        <div class="stat-value" id="treasure_found">0</div>
                    </div>
                    
                    <div class="stat-row">
                        <div class="stat-label">‚úÖ Quests Completed</div>
                        <div class="stat-value" id="quests_completed">0</div>
                    </div>
                </div>
            </div>

            <div class="tool-panel">
                <h3 class="tool-title">üèÜ Achievements</h3>
                
                <div class="quest-tracker">
                    <div class="quest-item">
                        <div class="quest-checkbox" id="achievement_roller">üèÜ</div>
                        <div class="quest-text">Dice Master: Roll 100 times</div>
                    </div>
                    
                    <div class="quest-item">
                        <div class="quest-checkbox" id="achievement_warrior">üèÜ</div>
                        <div class="quest-text">Warrior: Win 25 combat encounters</div>
                    </div>
                    
                    <div class="quest-item">
                        <div class="quest-checkbox" id="achievement_mage">üèÜ</div>
                        <div class="quest-text">Archmage: Cast 50 spells</div>
                    </div>
                    
                    <div class="quest-item">
                        <div class="quest-checkbox" id="achievement_treasure">üèÜ</div>
                        <div class="quest-text">Treasure Hunter: Find 20 treasures</div>
                    </div>
                    
                    <div class="quest-item">
                        <div class="quest-checkbox" id="achievement_quest">üèÜ</div>
                        <div class="quest-text">Quest Master: Complete 10 objectives</div>
                    </div>
                </div>
            </div>
        </div>

        <h2>üéØ Pro Tips & Advanced Features</h2>
        
        <div class="course-section">
            <h3 style="color: #a663cc; margin-bottom: 20px;">üßô Master Your Digital Adventure</h3>
            
            <p style="color: #c5cae9; margin-bottom: 20px;"><strong>Maximize your HeroQuest experience with these advanced toolkit features:</strong></p>
            
            <div class="course-grid">
                <div style="background: rgba(83, 52, 131, 0.3); border: 2px solid #9c88ff; border-radius: 10px; padding: 20px;">
                    <h4 style="color: #9c88ff; margin-bottom: 15px;">üé≤ True HeroQuest Dice System</h4>
                    <ul style="color: #c5cae9; padding-left: 20px;">
                        <li><strong>Attack Power:</strong> Number of combat dice to roll (each die: 50% hit chance)</li>
                        <li><strong>Defense Power:</strong> Number of shield dice to roll (each die: 33% block chance)</li>
                        <li><strong>Movement:</strong> Base die roll + Movement Speed bonus</li>
                        <li><strong>Magic:</strong> Success rate improves with Magic Power level</li>
                    </ul>
                </div>
                
                <div style="background: rgba(83, 52, 131, 0.3); border: 2px solid #9c88ff; border-radius: 10px; padding: 20px;">
                    <h4 style="color: #9c88ff; margin-bottom: 15px;">üíö Enhanced Health System</h4>
                    <ul style="color: #c5cae9; padding-left: 20px;">
                        <li>Click hearts to toggle damage/healing</li>
                        <li>Use the heal button for full restoration</li>
                        <li>Character-specific health: Wizard(4), Barbarian(6), Elf(5), Dwarf(6), Expansion(5)</li>
                        <li>Track full party of 5 heroes including expansion characters</li>
                    </ul>
                </div>
                
                <div style="background: rgba(83, 52, 131, 0.3); border: 2px solid #9c88ff; border-radius: 10px; padding: 20px;">
                    <h4 style="color: #9c88ff; margin-bottom: 15px;">üîÆ Enhanced Spell Casting</h4>
                    <ul style="color: #c5cae9; padding-left: 20px;">
                        <li>Higher Magic Power = better spell success rates</li>
                        <li>Magic Power enhances spell effects and duration</li>
                        <li>Empowered spells with 3+ Magic Power</li>
                        <li>Mana management with visual feedback</li>
                    </ul>
                </div>
                
                <div style="background: rgba(83, 52, 131, 0.3); border: 2px solid #9c88ff; border-radius: 10px; padding: 20px;">
                    <h4 style="color: #9c88ff; margin-bottom: 15px;">‚öîÔ∏è Authentic Combat System</h4>
                    <ul style="color: #c5cae9; padding-left: 20px;">
                        <li>Attacker rolls Attack Power number of combat dice</li>
                        <li>Defender rolls Defense Power number of shield dice</li>
                        <li>Damage = Hits - Blocks (minimum 0)</li>
                        <li>Real HeroQuest combat mechanics with detailed breakdowns</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="notification" id="notification">
            üéâ Action completed successfully!
        </div>
    </div>

    <script>
        // Initialize floating dice effects
        function createFloatingDice() {
            const diceSymbols = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ', 'üé≤'];
            for (let i = 0; i < 6; i++) {
                const dice = document.createElement('div');
                dice.className = 'floating-dice';
                dice.textContent = diceSymbols[Math.floor(Math.random() * diceSymbols.length)];
                dice.style.top = Math.random() * 100 + '%';
                dice.style.animationDelay = Math.random() * 12 + 's';
                dice.style.animationDuration = (Math.random() * 4 + 10) + 's';
                document.querySelector('.toolkit-realm').appendChild(dice);
            }
        }
        
        createFloatingDice();
        
        // Game state
        let gameStats = {
            totalRolls: 0,
            combatEncounters: 0,
            spellsCast: 0,
            treasureFound: 0,
            questsCompleted: 0
        };
        
        let settings = {
            sound: true,
            vibration: false,
            advanced: false,
            autosave: true,
            theme: true
        };
        
        // Dice rolling functions with proper HeroQuest mechanics
        function rollSingleDie(element, type) {
            element.classList.add('rolling');
            
            setTimeout(() => {
                let baseResult;
                let diceCount = 1;
                let finalResult;
                
                switch(type) {
                    case 'combat':
                        diceCount = parseInt(document.getElementById('attack_stat').textContent);
                        baseResult = Math.random() < 0.5 ? 'Hit' : 'Miss';
                        finalResult = baseResult;
                        break;
                    case 'defense':
                        diceCount = parseInt(document.getElementById('defense_stat').textContent);
                        baseResult = Math.random() < 0.33 ? 'Block' : 'Hit';
                        finalResult = baseResult;
                        break;
                    case 'movement':
                        baseResult = Math.floor(Math.random() * 6) + 1;
                        const movementBonus = parseInt(document.getElementById('movement_stat').textContent);
                        finalResult = baseResult + movementBonus;
                        break;
                    case 'magic':
                        const magicPower = parseInt(document.getElementById('magic_stat').textContent);
                        const successChance = Math.min(0.9, 0.3 + (magicPower * 0.1));
                        baseResult = Math.random() < successChance ? 'Success' : 'Failure';
                        finalResult = baseResult;
                        break;
                }
                
                if (type === 'movement') {
                    element.textContent = finalResult;
                    showNotification(`Movement: ${baseResult} + ${parseInt(document.getElementById('movement_stat').textContent)} = ${finalResult} spaces`);
                } else if (type === 'combat' || type === 'defense') {
                    element.textContent = finalResult === 'Hit' || finalResult === 'Block' ? '‚úì' : '‚úó';
                    showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)}: ${finalResult} (using ${diceCount} dice)`);
                } else {
                    element.textContent = finalResult === 'Success' ? '‚≠ê' : 'üåü';
                    showNotification(`Magic: ${finalResult}`);
                }
                
                element.classList.remove('rolling');
                updateStats('totalRolls', 1);
                
                if (settings.sound) {
                    playSound('dice');
                }
            }, 1000);
        }
        
        function rollDice(type, baseCount) {
            const resultsDiv = document.getElementById('dice_results');
            resultsDiv.innerHTML = '<div class="result-total">Rolling...</div>';
            
            let actualDiceCount = baseCount;
            let results = [];
            let successes = 0;
            let totalValue = 0;
            
            // Determine actual number of dice to roll based on character stats
            if (type === 'combat') {
                actualDiceCount = parseInt(document.getElementById('attack_stat').textContent);
            } else if (type === 'defense') {
                actualDiceCount = parseInt(document.getElementById('defense_stat').textContent);
            }
            
            for (let i = 0; i < actualDiceCount; i++) {
                setTimeout(() => {
                    let baseResult;
                    let modifiedResult;
                    
                    switch(type) {
                        case 'combat':
                            baseResult = Math.random() < 0.5 ? 'Hit' : 'Miss';
                            if (baseResult === 'Hit') {
                                successes++;
                            }
                            results.push(baseResult);
                            break;
                        case 'defense':
                            baseResult = Math.random() < 0.33 ? 'Block' : 'Hit';
                            if (baseResult === 'Block') {
                                successes++;
                            }
                            results.push(baseResult);
                            break;
                        case 'movement':
                            baseResult = Math.floor(Math.random() * 6) + 1;
                            const movementBonus = parseInt(document.getElementById('movement_stat').textContent);
                            modifiedResult = baseResult + movementBonus;
                            totalValue += modifiedResult;
                            results.push(`${baseResult}+${movementBonus}=${modifiedResult}`);
                            break;
                        case 'magic':
                            const magicPower = parseInt(document.getElementById('magic_stat').textContent);
                            const successChance = Math.min(0.9, 0.3 + (magicPower * 0.1));
                            baseResult = Math.random() < successChance ? 'Success' : 'Failure';
                            if (baseResult === 'Success') {
                                successes++;
                            }
                            results.push(`${baseResult}`);
                            break;
                    }
                    
                    if (results.length === actualDiceCount) {
                        let totalText;
                        let breakdownText;
                        
                        if (type === 'movement') {
                            totalText = `${totalValue} Total Spaces`;
                            breakdownText = `${actualDiceCount} dice: ${results.join(', ')}`;
                        } else if (type === 'combat') {
                            totalText = `${successes} Hits (${actualDiceCount} attack dice)`;
                            breakdownText = `Results: ${results.join(', ')}`;
                        } else if (type === 'defense') {
                            totalText = `${successes} Blocks (${actualDiceCount} defense dice)`;
                            breakdownText = `Results: ${results.join(', ')}`;
                        } else {
                            totalText = `${successes} Successes (${actualDiceCount} magic attempts)`;
                            breakdownText = `Results: ${results.join(', ')}`;
                        }
                        
                        resultsDiv.innerHTML = `
                            <div class="result-total">${totalText}</div>
                            <div class="result-breakdown">${breakdownText}</div>
                        `;
                        
                        updateStats('totalRolls', actualDiceCount);
                        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} roll complete: ${successes > 0 || totalValue > 0 ? 'Success!' : 'No success.'}`);
                    }
                }, i * 200 + 500);
            }
        }
        
        function quickRoll(type) {
            switch(type) {
                case 'combat':
                    rollDice('combat', 2);
                    break;
                case 'defense':
                    rollDice('defense', 2);
                    break;
                case 'movement':
                    rollDice('movement', 2);
                    break;
                case 'magic':
                    rollDice('magic', 1);
                    break;
            }
        }
        
        // Character sheet functions with proper HeroQuest feedback
        function modifyStat(stat, change) {
            const element = document.getElementById(stat + '_stat');
            let currentValue = parseInt(element.textContent);
            let newValue = Math.max(0, currentValue + change);
            
            if (stat === 'gold') {
                newValue = Math.max(0, currentValue + change);
            }
            
            element.textContent = newValue;
            
            // Visual feedback
            element.style.transform = 'scale(1.2)';
            element.style.color = change > 0 ? '#4caf50' : '#f44336';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
                element.style.color = '#fff';
            }, 300);
            
            // Update combat stats display if relevant
            if (stat === 'attack') {
                const heroAttackDisplay = document.getElementById('hero_attack');
                if (heroAttackDisplay) heroAttackDisplay.textContent = newValue;
            } else if (stat === 'defense') {
                const heroDefenseDisplay = document.getElementById('hero_defense');
                if (heroDefenseDisplay) heroDefenseDisplay.textContent = newValue;
            }
            
            showNotification(`${stat.charAt(0).toUpperCase() + stat.slice(1)} ${change > 0 ? 'increased' : 'decreased'} to ${newValue}${getStatBonus(stat, newValue)}`);
        }
        
        // Helper function to show proper HeroQuest stat bonuses
        function getStatBonus(stat, value) {
            switch(stat) {
                case 'attack':
                    return ` (Roll ${value} combat dice)`;
                case 'defense':
                    return ` (Roll ${value} defense dice)`;
                case 'movement':
                    return ` (Movement bonus: +${value})`;
                case 'magic':
                    return ` (Spell power: ${Math.min(90, 30 + (value * 10))}% success)`;
                case 'gold':
                    return ` coins`;
                default:
                    return '';
            }
        }
        
        // Health tracking functions
        function toggleHeart(heart) {
            heart.classList.toggle('empty');
            
            if (settings.sound) {
                playSound(heart.classList.contains('empty') ? 'damage' : 'heal');
            }
        }
        
        function restoreHealth(characterId) {
            const hearts = document.querySelectorAll(`#${characterId} .heart`);
            hearts.forEach(heart => heart.classList.remove('empty'));
            showNotification('Health fully restored!');
        }
        
        function restoreAll() {
            const allHearts = document.querySelectorAll('.heart');
            allHearts.forEach(heart => heart.classList.remove('empty'));
            showNotification('All party members fully healed!');
        }
        
        // Quest tracking functions
        function toggleQuest(questItem) {
            const checkbox = questItem.querySelector('.quest-checkbox');
            checkbox.classList.toggle('completed');
            
            if (checkbox.classList.contains('completed')) {
                checkbox.textContent = '‚úì';
                updateStats('questsCompleted', 1);
                showNotification('Quest objective completed!');
            } else {
                checkbox.textContent = '';
                updateStats('questsCompleted', -1);
            }
        }
        
        // Treasure generation
        const treasures = [
            'üí∞ 50 Gold Coins',
            '‚öîÔ∏è Magic Sword (+1 Attack)',
            'üõ°Ô∏è Shield of Protection (+1 Defense)',
            'üè∫ Healing Potion (Restore 2 Health)',
            'üîÆ Mana Crystal (+2 Magic Power)',
            'üëë Crown of Wisdom (+1 to all stats)',
            'üíé Precious Gem (100 Gold)',
            'üìú Ancient Scroll (Learn new spell)',
            'üóùÔ∏è Master Key (Opens any door)',
            '‚ö° Lightning Ring (Cast Lightning Bolt)',
            'üß™ Elixir of Strength (+2 Attack)',
            'üåü Star of Fortune (Re-roll any die)',
            'üèπ Elven Bow (+1 Range Attack)',
            'ü¶∂ Boots of Speed (+1 Movement)',
            'üßô Wizard\'s Staff (+2 Magic Power)',
            'üíç Ring of Protection (+1 Defense)',
            'üçñ Hero\'s Feast (Full party heal)',
            'üé≤ Lucky Dice (Advantage on next roll)'
        ];
        
        function generateTreasure() {
            const display = document.getElementById('treasure_display');
            display.textContent = 'Searching for treasure...';
            
            setTimeout(() => {
                const treasure = treasures[Math.floor(Math.random() * treasures.length)];
                display.innerHTML = `<strong>üéâ Treasure Found! üéâ</strong><br>${treasure}`;
                updateStats('treasureFound', 1);
                showNotification('New treasure discovered!');
                
                if (settings.sound) {
                    playSound('treasure');
                }
            }, 1500);
        }
        
        // Spell casting functions
        function toggleMana(manaCircle) {
            manaCircle.classList.toggle('spent');
        }
        
        function restoreMana() {
            const manaCircles = document.querySelectorAll('.mana-circle');
            manaCircles.forEach(circle => circle.classList.remove('spent'));
            showNotification('All mana restored!');
        }
        
        function castSpell(spellCard, cost) {
            const manaCircles = document.querySelectorAll('.mana-circle:not(.spent)');
            
            if (manaCircles.length >= cost) {
                // Spend mana
                for (let i = 0; i < cost; i++) {
                    manaCircles[i].classList.add('spent');
                }
                
                // Visual feedback
                spellCard.classList.add('selected');
                setTimeout(() => {
                    spellCard.classList.remove('selected');
                }, 1000);
                
                updateStats('spellsCast', 1);
                showNotification(`${spellCard.querySelector('.spell-name').textContent} cast successfully!`);
                
                if (settings.sound) {
                    playSound('spell');
                }
            } else {
                showNotification('Not enough mana to cast this spell!');
            }
        }
        
        // Combat calculator with proper HeroQuest dice mechanics
        function calculateCombat(attacker) {
            const resultsDiv = document.getElementById('combat_results');
            resultsDiv.innerHTML = '<div class="result-total">Calculating...</div>';
            
            setTimeout(() => {
                // Get number of dice to roll from character stats
                const heroAttackDice = parseInt(document.getElementById('attack_stat').textContent);
                const heroDefenseDice = parseInt(document.getElementById('defense_stat').textContent);
                const monsterAttackDice = parseInt(document.getElementById('monster_attack').textContent);
                const monsterDefenseDice = parseInt(document.getElementById('monster_defense').textContent);
                
                let attackerDice, defenderDice, attackerName, defenderName;
                
                if (attacker === 'hero') {
                    attackerDice = heroAttackDice;
                    defenderDice = monsterDefenseDice;
                    attackerName = 'Hero';
                    defenderName = 'Monster';
                } else {
                    attackerDice = monsterAttackDice;
                    defenderDice = heroDefenseDice;
                    attackerName = 'Monster';
                    defenderName = 'Hero';
                }
                
                // Roll attack dice
                let attackHits = 0;
                let attackRolls = [];
                for (let i = 0; i < attackerDice; i++) {
                    const roll = Math.random() < 0.5 ? 'Hit' : 'Miss';
                    attackRolls.push(roll);
                    if (roll === 'Hit') attackHits++;
                }
                
                // Roll defense dice
                let defenseBlocks = 0;
                let defenseRolls = [];
                for (let i = 0; i < defenderDice; i++) {
                    const roll = Math.random() < 0.33 ? 'Block' : 'Hit';
                    defenseRolls.push(roll);
                    if (roll === 'Block') defenseBlocks++;
                }
                
                // Calculate damage
                const damage = Math.max(0, attackHits - defenseBlocks);
                const hit = damage > 0;
                
                // Update display
                document.getElementById('hero_attack').textContent = heroAttackDice;
                document.getElementById('hero_defense').textContent = heroDefenseDice;
                
                resultsDiv.innerHTML = `
                    <div class="result-total">${hit ? `${damage} Damage!` : 'No Damage!'}</div>
                    <div class="result-breakdown">
                        ${attackerName} rolled ${attackerDice} dice: ${attackRolls.join(', ')} = ${attackHits} hits<br>
                        ${defenderName} rolled ${defenderDice} dice: ${defenseRolls.join(', ')} = ${defenseBlocks} blocks<br>
                        ${attackHits} hits - ${defenseBlocks} blocks = ${damage} damage
                    </div>
                `;
                
                if (hit) {
                    const defenderType = attacker === 'hero' ? 'monster' : 'hero';
                    const healthElement = document.getElementById(`${defenderType}_health`);
                    const currentHealth = parseInt(healthElement.textContent);
                    healthElement.textContent = Math.max(0, currentHealth - damage);
                    
                    updateStats('combatEncounters', 1);
                }
                
                showNotification(`Combat complete: ${hit ? `${damage} damage dealt!` : 'Attack blocked!'}!`);
            }, 1000);
        }
        
        // Settings functions
        function toggleSetting(toggle, setting) {
            toggle.classList.toggle('active');
            settings[setting] = toggle.classList.contains('active');
            
            showNotification(`${setting.charAt(0).toUpperCase() + setting.slice(1)} ${settings[setting] ? 'enabled' : 'disabled'}`);
        }
        
        // Statistics functions
        function updateStats(stat, change) {
            gameStats[stat] += change;
            gameStats[stat] = Math.max(0, gameStats[stat]);
            
            const element = document.getElementById(stat);
            if (element) {
                element.textContent = gameStats[stat];
                
                // Visual feedback
                element.style.transform = 'scale(1.1)';
                element.style.color = '#ffc107';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = '#c5cae9';
                }, 300);
            }
            
            checkAchievements();
        }
        
        function checkAchievements() {
            // Check for achievement unlocks
            if (gameStats.totalRolls >= 100) {
                unlockAchievement('achievement_roller');
            }
            if (gameStats.combatEncounters >= 25) {
                unlockAchievement('achievement_warrior');
            }
            if (gameStats.spellsCast >= 50) {
                unlockAchievement('achievement_mage');
            }
            if (gameStats.treasureFound >= 20) {
                unlockAchievement('achievement_treasure');
            }
            if (gameStats.questsCompleted >= 10) {
                unlockAchievement('achievement_quest');
            }
        }
        
        function unlockAchievement(achievementId) {
            const achievement = document.getElementById(achievementId);
            if (achievement && !achievement.classList.contains('completed')) {
                achievement.classList.add('completed');
                showNotification('üèÜ Achievement Unlocked!');
                
                if (settings.sound) {
                    playSound('achievement');
                }
            }
        }
        
        // Utility functions
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function playSound(type) {
            if (!settings.sound) return;
            
            try {
                // Create audio context for sound effects
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different sounds for different actions
                switch(type) {
                    case 'dice':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime + 0.1);
                        break;
                    case 'spell':
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(900, audioContext.currentTime + 0.2);
                        break;
                    case 'treasure':
                        oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.2);
                        break;
                    case 'achievement':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.3);
                        break;
                    case 'heal':
                        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.15);
                        break;
                    case 'damage':
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(100, audioContext.currentTime + 0.2);
                        break;
                }
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function saveProgress() {
            try {
                const gameData = {
                    stats: gameStats,
                    settings: settings,
                    characterStats: {
                        attack: document.getElementById('attack_stat').textContent,
                        defense: document.getElementById('defense_stat').textContent,
                        movement: document.getElementById('movement_stat').textContent,
                        magic: document.getElementById('magic_stat').textContent,
                        gold: document.getElementById('gold_stat').textContent
                    },
                    questProgress: Array.from(document.querySelectorAll('.quest-checkbox')).map(cb => cb.classList.contains('completed')),
                    achievements: Array.from(document.querySelectorAll('[id^="achievement_"]')).map(ach => ach.classList.contains('completed'))
                };
                
                // In a real implementation, this would save to a database or file
                localStorage.setItem('heroquest_save', JSON.stringify(gameData));
                showNotification('Game progress saved successfully!');
                
                if (settings.sound) {
                    playSound('achievement');
                }
            } catch (error) {
                showNotification('Save failed - storage not available');
            }
        }
        
        function loadProgress() {
            try {
                const savedData = localStorage.getItem('heroquest_save');
                if (savedData) {
                    const gameData = JSON.parse(savedData);
                    gameStats = gameData.stats;
                    settings = gameData.settings;
                    
                    // Restore character stats
                    if (gameData.characterStats) {
                        document.getElementById('attack_stat').textContent = gameData.characterStats.attack;
                        document.getElementById('defense_stat').textContent = gameData.characterStats.defense;
                        document.getElementById('movement_stat').textContent = gameData.characterStats.movement;
                        document.getElementById('magic_stat').textContent = gameData.characterStats.magic;
                        document.getElementById('gold_stat').textContent = gameData.characterStats.gold;
                    }
                    
                    // Update statistics display
                    Object.keys(gameStats).forEach(stat => {
                        const element = document.getElementById(stat);
                        if (element) {
                            element.textContent = gameStats[stat];
                        }
                    });
                    
                    showNotification('Game progress loaded successfully!');
                } else {
                    showNotification('No saved game found. Starting fresh adventure!');
                }
            } catch (error) {
                showNotification('Load failed - starting fresh adventure!');
            }
        }
        
        // Initialize the toolkit
        function initializeToolkit() {
            // Set up initial game state
            updateStats('totalRolls', 0);
            updateStats('combatEncounters', 0);
            updateStats('spellsCast', 0);
            updateStats('treasureFound', 0);
            updateStats('questsCompleted', 0);
            
            // Show welcome message
            setTimeout(() => {
                showNotification('üé≤ HeroQuest Digital Toolkit Ready! üõ†Ô∏è');
            }, 1000);
        }
        
        // Auto-save functionality
        function autoSave() {
            if (settings.autosave) {
                saveProgress();
            }
        }
        
        // Save progress every 5 minutes if auto-save is enabled
        setInterval(autoSave, 300000);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 's':
                        event.preventDefault();
                        saveProgress();
                        break;
                    case 'r':
                        event.preventDefault();
                        quickRoll('combat');
                        break;
                    case 'd':
                        event.preventDefault();
                        quickRoll('defense');
                        break;
                    case 'm':
                        event.preventDefault();
                        quickRoll('movement');
                        break;
                    case 'g':
                        event.preventDefault();
                        quickRoll('magic');
                        break;
                    case 't':
                        event.preventDefault();
                        generateTreasure();
                        break;
                    case 'h':
                        event.preventDefault();
                        restoreAll();
                        break;
                }
            }
        });
        
        // Touch/mobile support
        if ('ontouchstart' in window) {
            // Add mobile-specific enhancements
            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('.die, .roll-btn, .treasure-btn').forEach(element => {
                    element.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    element.addEventListener('touchend', function() {
                        this.style.transform = '';
                    });
                });
            });
        }
        
        // Vibration support for mobile devices
        function vibrate(pattern) {
            if (pattern === undefined) pattern = [100];
            if (settings.vibration && 'vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }
        
        // Add vibration to key interactions
        function addVibrationToAction(element, pattern) {
            if (pattern === undefined) pattern = [50];
            element.addEventListener('click', () => {
                vibrate(pattern);
            });
        }
        
        // Advanced features for power users
        function enableAdvancedMode() {
            if (settings.advanced) {
                // Add advanced statistics tracking
                // Add custom dice configurations
                // Add macro recording capabilities
                // Add scripting support for complex actions
                showNotification('Advanced mode activated! Additional features unlocked.');
            }
        }
        
        // Performance optimization for animations
        function optimizePerformance() {
            // Reduce animations on lower-end devices
            if (navigator.hardwareConcurrency && navigator.hardwareConcurrency < 4) {
                document.documentElement.style.setProperty('--animation-duration', '0.2s');
            }
        }
        
        // Error handling and recovery
        window.addEventListener('error', function(event) {
            console.error('Toolkit error:', event.error);
            showNotification('‚ö†Ô∏è An error occurred. Toolkit functionality may be limited.');
        });
        
        // Offline support detection
        function checkOnlineStatus() {
            if (!navigator.onLine) {
                showNotification('üì± Offline mode: All features still available!');
            }
        }
        
        window.addEventListener('online', () => {
            showNotification('üåê Back online! All features restored.');
        });
        
        window.addEventListener('offline', checkOnlineStatus);
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeToolkit();
            optimizePerformance();
            checkOnlineStatus();
            
            // Initialize vibration for interactive elements
            document.querySelectorAll('.die, .roll-btn, .treasure-btn, .spell-card').forEach(element => {
                addVibrationToAction(element);
            });
            
            // Watch for advanced mode toggle
            const advancedToggle = document.getElementById('advanced_toggle');
            if (advancedToggle) {
                advancedToggle.addEventListener('click', () => {
                    setTimeout(enableAdvancedMode, 100);
                });
            }
        });
        
        // Prevent context menu on right-click for better mobile experience
        document.addEventListener('contextmenu', function(event) {
            if (event.target.classList.contains('die') || 
                event.target.classList.contains('roll-btn') ||
                event.target.classList.contains('treasure-btn')) {
                event.preventDefault();
            }
        });
        
        // Add fullscreen support for immersive gaming
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showNotification('Fullscreen not supported on this device.');
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // Double-tap to go fullscreen on mobile
        let lastTap = 0;
        document.addEventListener('touchend', function(event) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 500 && tapLength > 0) {
                toggleFullscreen();
            }
            lastTap = currentTime;
        });
        
        // Export functionality for sharing game state
        function exportGameState() {
            try {
                const gameData = {
                    stats: gameStats,
                    timestamp: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(gameData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'heroquest_save.json';
                link.click();
                
                showNotification('Game state exported successfully!');
            } catch (error) {
                showNotification('Export failed - feature not supported');
            }
        }
        
        // Add export button functionality
        function addExportButton() {
            const settingsPanel = document.querySelector('.settings-panel');
            if (settingsPanel) {
                const exportBtn = document.createElement('button');
                exportBtn.className = 'roll-btn';
                exportBtn.textContent = 'üì§ Export Data';
                exportBtn.onclick = exportGameState;
                exportBtn.style.marginTop = '10px';
                exportBtn.style.width = '100%';
                settingsPanel.appendChild(exportBtn);
            }
        }
        
        // Call this after DOM is loaded
        setTimeout(addExportButton, 1000);
    </script>
</body>
</html>
